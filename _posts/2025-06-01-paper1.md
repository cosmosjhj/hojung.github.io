---
layout: post
title: Paper 1
subtitle: 'ENHANCING THE SCALABILITY AND APPLICABILITY OF KOHN-SHAM HAMILTONIANS FOR MOLECULAR SYSTEMS'
cover-img: /assets/img/path.jpg
thumbnail-img: /assets/img/thumb.png
share-img: /assets/img/path.jpg
tags: [books, test]
author: Hojung Jung
---

This is the review of the paper 'ENHANCING THE SCALABILITY AND APPLICABILITY OF KOHN-SHAM HAMILTONIANS FOR MOLECULAR SYSTEMS' published in ICLR 2025. I will summarize backgrounds on DFT, main methods in the paper, main result with addition of my personal thought (discussion). Please feel free to reach me for further discussion and possible idea development.

**One line summary : This paper enhances DFT calculation by proposing novel architecture with refined loss that considers eigenvalues of the Kohn-Sham equations.**

# 1 Density-Functional Theory (DFT)
In this section, i will introduce what is Density-Functional Theory (DFT) and its implications in the science domain.

In quantum mechanics, properties of molecules are determined by wave function of the electrons, which is defined by Schrodinger equation given by the following equations.

$$
H\Psi=E\Psi.
$$

By identyfing the ground state energies of the wave function by solving eigenvalue equations, one could. However, this could be highly non-linear when the number of atoms increases (i.e, in many-body scenario) becoming analytically hard to solve. 

To mitigate this issue, physicists and chemists often rely on Density-Functional Theory (DFT) is an **ab-initio quantum-mechanical framework** that replaces the
$3N$-dimensional many-electron wave-function $\Psi(\mathbf r_1,\dots,\mathbf r_N)$
with the **electron density**:

$$
\rho(\mathbf r)=\sum_{i\in\text{occ}}|\psi_i(\mathbf r)|^2,
$$

a function that depends on only **three spatial variables**.
  
* **Hohenberg–Kohn theorems (1964)** prove that the ground-state energy $E_0$
  is a unique functional $E[\rho]$ of the density and that the exact density
  minimises this functional.
* **Kohn–Sham equations (1965)** map the interacting problem onto an auxiliary
  set of one-electron equations

$$
\mathbf{H[\rho]}\mathbf{C} = \mathbf{S}\mathbf{C}\epsilon,
$$
  
  where the effective Hamiltonian
  $\mathbf H=\mathbf T+\mathbf V_{\text{ext}}+\mathbf V_{\text H}[\rho]+\mathbf V_{\text{xc}}[\rho]$
  contains the **Hartree** ($\mathbf V_{\text H}$) and **exchange–correlation**
  ($\mathbf V_{\text{xc}}$) potentials.

---


### 1.1 Kohn–Sham formulation  
We can represent Molecule $\mathcal{M}$ wiht the atomic number of nuclei ($\mathcal{Z}$) and the 3d coordinates ($\mathcal{R}$):

$$
\mathcal{M} = 
{Z_{1},\dots,Z_{N},\mathbf{R_{1}},\dots,\mathbf{R_{N}}},
$$  

DFT tries to solve the following eigenvalue problems (it estimates ground-stsate energy of the electron wave functions which determines quantum chemical properties according to quantum mechanics!)  

$$
\mathbf{H}\mathbf{C}
= \mathbf{S}\mathbf{C}\epsilon,
\qquad
\rho(\mathbf{r})=\sum_{i\in\text{occ}}
|\psi_{i}(\mathbf{r})|^{2}.
$$

The above equation is self-consistent in a sense that Hamiltonian $H$ dependes on the coefficient matrix $C$ itself. Thus one resort to numerical methods including Self-Consistent-Field (SCF) method for approximating the above eigenvalue problem. SCF method solves above euqation by iteratively updating the Hamiltonian and the coefficient matrix by the following euqation:

$$
\mathbf{H}^{(k)}(\mathbf{C}^{(k-1)})\,
\mathbf{C}^{(k)}=
\mathbf{S}\,\mathbf{C}^{(k)}\,{\epsilon}^{(k)}.
$$

The practical bottleneck is solving the *self-consistent-field* (SCF) cycle that
links $\mathbf H$ and the density, typically scaling as $\mathcal O(N^{3\text{–}4})$.

| Symbol | Meaning | Size |
|--------|---------|------|
| $\mathbf H[\rho]$ | KS Hamiltonian: $\mathbf T+\mathbf V_{\text{ext}}+\mathbf V_{\text H}[\rho]+\mathbf V_{\text{xc}}[\rho]$ | $B\times B$ |
| $\mathbf S$ | AO overlap | $B\times B$ |
| $\mathbf C$ | AO→MO coeffs | $B\times N$ |
| $\epsilon$ | $\mathrm{diag}(\epsilon_i)$ | $N\times N$ |

### 1.2 SCF cost is high even with numerical methods

There are three steps for traiditional numerical methods for estimating the solutions of SCF method. 

1. **Build** $\mathbf H^{(k)}[\rho^{(k-1)}]$ – $\mathcal O(B^{3})$  
2. **Solve** eigensystem – $\mathcal O(B^{3})$  
3. **Mix** density, test convergence  

Combining three steps together, one need the complexity of $\mathcal O(TB^{3})$ with $B\!\sim\!N$.

### 1.3 Why predict $\hat{\mathbf H}$?  
* One diagonalisation ⇒ energies, forces, dipoles …  
* At most one SCF micro-step (Δ-SCF)  
* Asymptotic cost $\mathcal O(B^{3})$.

---

# 2 Method: WALoss + WANet

The author argued that MAE loss between matrix is highly sensitive to perturbations which is prone to error in the perspective of ML. Previous works such as networks such as PhisNet (Unke et al., 2021b) and QHNet (Yu et al., 2023b) optimize loss function built on the MAE loss which leads to instability of the training with the larger size molecules. To prevent this instability they suggest loss based on the eigenvalues which i will explain further in the below.

## 2.1 Element-wise losses break at scale  
On PubChemQH (40–100 atoms) a $10^{-2}$ relative MAE in $\mathbf H$ yields  
$10^{6}\,\text{kcal}\,\text{mol}^{-1}$ energy error.

Perturbative bound  

$$
|\lambda_i(\hat{\mathbf H},\mathbf S)-\lambda_i(\mathbf H,\mathbf S)|
\le
\frac{\kappa(\mathbf S)}{\lVert\mathbf S\rVert_2}\,
\lVert\Delta\mathbf H\rVert_{1,1},
$$  

shows ill-conditioned $\mathbf S$ and large $B$ amplify small entry-wise errors.

## 2.2 Wave-function Alignment Loss (WALoss)

* **Simultaneous reduction** gives $\mathbf{C^{\star}}$ with  
  $(\mathbf{C^{\star}})^{\top}\mathbf{S}\mathbf{C^{\star}}=\mathbf{I}$.
  
* **Evaluate**  
  $\tilde{\mathbf{H}}=(\mathbf{C^{\star}})^{\top}\hat{\mathbf{H}}\mathbf{C^{\star}}$.

* **Align key eigenvalues**   
  $\mathcal{L}_{\text{WA}}$

No back-prop through an eigensolver → stable training.

## 2.3 WANet architecture  

| Stage | Core idea | Cost | Role |
|-------|-----------|------|------|
| Node conv. | eSCN (SO (2)) | $O(L^{3})$ | Cheap irreps |
| Pair block | Sparse MoE | const. | Off-diagonals |
| Diagonal block | MACE many-body | $O(K\nu)$ | Correlation |
| Head | Clebsch–Gordan → Hermitian | — | $\hat{\mathbf H}$ |

SE (3)-equivariant throughout; output Hermitian.

---

# 3 Experiments

## 3.1 Datasets

| Set | Size | Atom range | Level |
|-----|------|------------|-------|
| QH9 | 130 k | ≤ 9 heavy | B3LYP/def2-SVP |
| PubChemQH | 50 k | 40–100 | B3LYP/def2-TZV |

## 3.2 Metrics  
Hamiltonian MAE, eigenspectrum MAE, eigen-vector cosine, total-energy MAE, relative SCF steps.

## 3.3 PubChemQH results

| Model | MAE($E_\text{tot}$) | Rel. SCF | MAE($\mathbf H$) |
|-------|--------------------|----------|------------------|
| QHNet | 65 721 | 3.7× | 0.78 |
| QHNet + WA | 75.6 | 0.9× | 0.52 |
| **WANet + WA** | **47.2** | **0.82×** | **0.47** |
| Init guess | 374 | 1.0× | 0.55 |

Energy ↓ × 1347, SCF ↓ 18 %.

---

# 4 Discussion

* WALoss enforces first-order perturbation consistency → stability.  
* eSCN lowers SO (3) cost $O(L^{6}) \to O(L^{3})$; MoE handles long-range physics.  
* One $\hat{\mathbf H}$ gives energies, dipoles, spectra ⇒ beats single-task regressors.  
* Open: dataset cost, SCF-free forces, periodic transfer.

---

# 5 Conclusion

WALoss + WANet erase catastrophic scaling:

* **Energy error ↓ 10³×**  
* **SCF wall-time ↓ ≈ 18 %**  
* Generalises to 180-atom alkanes.

A new SOTA for deep-learning-augmented DFT.
