---
layout: post
title: Paper 1
subtitle: 'ENHANCING THE SCALABILITY AND APPLICABILITY OF KOHN-SHAM HAMILTONIANS FOR MOLECULAR SYSTEMS'
cover-img: /assets/img/path.jpg
thumbnail-img: /assets/img/thumb.png
share-img: /assets/img/path.jpg
tags: [books, test]
author: Hojung Jung
---

{: .box-success}
One line summary : This paper enhances DFT calculation by proposing novel architecture with refined loss that considers eigenvalues of the Kohn-Sham equations.

# 1 Density-Functional Theory (DFT) and its preliminaries

### 1.1 Kohn–Sham formulation  
Given nuclear configuration  

$$
\mathcal{M} \;=\;
\{ Z_1,\ldots,Z_N \;;\; \mathbf R_1,\ldots,\mathbf R_N \}
$$

DFT replaces the many-body Schrödinger problem with an effective **Kohn–Sham (KS) one-body problem**:

$$
\mathbf H[\rho]\,\mathbf C \;=\; \mathbf S\,\mathbf C\,\boldsymbol\epsilon,
\qquad
\rho(\mathbf r)=\sum_{i\in\text{occ}}
\bigl|\psi_i(\mathbf r)\bigr|^{2}.
$$

| Symbol | Meaning | Size |
|--------|---------|------|
| \(\mathbf H[\rho]\) | KS Hamiltonian = \( \mathbf T + \mathbf V_{\text{ext}} + \mathbf V_{\text H}[\rho] + \mathbf V_\text{xc}[\rho]\) | \(B\times B\) |
| \(\mathbf S\) | AO overlap matrix | \(B\times B\) |
| \(\mathbf C\) | AO → MO coefficients | \(B\times N\) |
| \(\boldsymbol\epsilon\) | MO energies diag.\((\epsilon_i)\) | \(N\times N\) |

### 1.2 Self-consistent-field (SCF) cost  
Each SCF micro-cycle:

1. **Build** \(\mathbf H^{(k)}[\rho^{(k-1)}]\) \(\mathcal O(B^{3})\) with density-fitting.  
2. **Solve** generalised eigensystem \(\mathcal O(B^{3})\).  
3. **Mix** density and check convergence.

With \(T\) SCF iterations and \(B\!\sim\!N\) basis functions, wall time is \(\mathcal O(N^{3\text{–}4})\).

### 1.3 Why learn the Hamiltonian?  
If a model predicts a *physically consistent* \(\hat{\mathbf H}\):

* diagonalise once → get total energy, forces, dipole, spectra;  
* run one SCF micro-cycle at most (“Δ-SCF”);  
* asymptotically \(\mathcal O(B^{3})\) instead of \(\mathcal O(T B^{3})\).

---

# 2 Method: Wave-function Alignment Loss & WANet

## 2.1 Element-wise losses fail at scale  

*Empirical SAD*: on new PubChemQH (40–100-atom) molecules,  
\(10^{-2}\) relative MAE on \(\mathbf H\) → up to \(10^{6}\,\mathrm{kcal\,mol^{-1}}\) energy error.  

**Perturbative bound**

$$
\bigl|\lambda_i(\hat{\mathbf H},\mathbf S)-\lambda_i(\mathbf H,\mathbf S)\bigr|
\;\le\;
\frac{\kappa(\mathbf S)}{\|\mathbf S\|_2}\,
\|\Delta\mathbf H\|_{1,1},
$$

so ill-conditioned \(\mathbf S\) and large \(B\) amplify tiny element-wise errors.

## 2.2 Wave-function Alignment Loss (WALoss)  

1. **Simultaneous reduction**  
   *Robustly* diagonalise reference pair \((\mathbf H^\star,\mathbf S)\)  
   → eigenvectors \(\mathbf C^\star\) satisfy \((\mathbf C^\star)^{\!\top}\mathbf S\,\mathbf C^\star=\mathbf I\).

2. **Physics-aware bilinear form**  
   Evaluate predicted matrix in that basis:
   $$
   \tilde{\mathbf H} = (\mathbf C^\star)^{\!\top}\hat{\mathbf H}\,\mathbf C^\star .
   $$

3. **Weighted eigenspectrum matching**
   $$
   \mathcal L_\text{WA} =
   \rho\!\!\sum_{j\in\text{occ}\cup\{\text{LUMO}\}}
     \bigl|\tilde H_{jj}-\epsilon^\star_j\bigr|^2
   \;+\;
   \xi\!\!\sum_{j\notin\text{occ}\cup\{\text{LUMO}\}}
     \bigl|\tilde H_{jj}-\epsilon^\star_j\bigr|^2,
   \qquad \rho\gg\xi.
   $$

*No eigen-back-prop* → numerically stable.

## 2.3 WANet architecture  

| Stage | Ingredients | Complexity | Purpose |
|-------|-------------|------------|---------|
| **Node Convolution Layer** | eSCN (SO(2) equivariant) | \(O(L^{3})\) | Builds irreps features cheaply |
| **Sparse MoE (pair)** | long/short-range experts + Gumbel gating | ~constant expert load | Off-diagonal blocks |
| **Many-body layer** | MACE-style density trick | \(O(K\nu)\) | Diagonal blocks, captures correlation |
| **Head** | Clebsch-Gordan tensor products, Hermitisation | — | Outputs \(\hat{\mathbf H}\) |

All operations respect SE(3) symmetry; output is Hermitian by design.

---

# 3 Experiments

## 3.1 Datasets  

| Dataset | Size | Atoms | Level | Purpose |
|---------|------|-------|-------|---------|
| **QH9** | 130 k | ≤9 heavy atoms | B3LYP/def2-SVP | Small-molecule sanity |
| **PubChemQH** | 50 k | 40–100 atoms | B3LYP/def2-TZV | Large-scale benchmark |

PubChemQH was generated on **128 × V100 GPUs × 1 month**.

## 3.2 Key metrics  

* **Hamiltonian MAE**  
* **Eigen-value MAE**: \(ϵ_\text{HOMO}, ϵ_\text{LUMO}, ϵ_\Delta\)  
* **Eigen-vector cosine** \( \cos\angle(\mathbf C^\star,\hat{\mathbf C}) \)  
* **Total energy MAE** via PySCF single-point  
* **Relative SCF iterations** vs. minao initial guess

## 3.3 Results (PubChemQH)

| Model | \(E_\text{tot}\) MAE (↓) | Rel. SCF (↓) | Hamiltonian MAE (↓) | Note |
|-------|-------------------------|--------------|---------------------|------|
| QHNet | 65 721 kcal mol\(^{-1}\) | 3.7× | 0.78 | baseline |
| QHNet + WALoss | 75.6 | 0.9× | 0.52 | shows WALoss benefit |
| **WANet + WALoss** | **47.2** | **0.82×** | **0.47** | SOTA |
| Initial guess | 374 | 1.0× | 0.55 | |

*Energy error ↓ × 1347, SCF iterations ↓ 18 %* versus learned baseline.

## 3.4 Property-regression baselines  
WANet + WALoss beats Equiformer-V2 / UniMol-Plus by **1–2 orders** on \(ϵ_\text{LUMO}\) and band-gap.

## 3.5 Scalability test – \( \mathrm{C}_x\mathrm H_{2x+2} \)  
For \(x=60\) (182 atoms) WALoss keeps HOMO/LUMO MAE < 100 kcal mol\(^{-1}\); other models diverge.

---

# 4 Discussion (personal viewpoint)

1. **Physics supervision ⇒ stability.**  
   WALoss internalises *first-order perturbation theory*, directly regularising the eigenspectrum that drives KS energy – curing the SAD pathology.  
2. **Architectural pragmatism.**  
   eSCN demotes SO(3) maths to SO(2), giving cubic (not sixth-power) complexity. Sparse MoE further caps cost while learning long-range physics.  
3. **Versatility over regression heads.**  
   A single \(\hat{\mathbf H}\) yields *any* single-particle observable (densities, dipoles, optical gaps): one network replaces dozens of regression models.  
4. **Limitations & open problems**  
   * Data generation cost is high; active-learning or Δ-learning on-the-fly could cut it.  
   * WALoss matches eigenvalues but not explicitly Fock potentials; full SCF-free DFT still needs forces & correlation.  
   * Transfer to periodic solids or mixed Gaussian/plane-wave bases is untested.  

---

# 5 Conclusion

*Wave-function Alignment Loss* aligns predicted Hamiltonians with their true eigenspaces, eliminating catastrophic scaling in large molecules. Coupled with a lean, equivariant *WANet* backbone and the new **PubChemQH** dataset, the method:


* **cuts total-energy error by 10³×**,  
* **reduces SCF wall-time by ~18 %**,  
* **generalises** to 180-atom alkanes beyond the training range.

These results set a new state-of-the-art for **deep-learning-augmented DFT**, moving practical ab-initio accuracy a step closer to millisecond inference.
