---
layout: post
title: Paper 1
subtitle: 'ENHANCING THE SCALABILITY AND APPLICABILITY OF KOHN-SHAM HAMILTONIANS FOR MOLECULAR SYSTEMS'
cover-img: /assets/img/path.jpg
thumbnail-img: /assets/img/thumb.png
share-img: /assets/img/path.jpg
tags: [books, test]
author: Hojung Jung
---

{: .box-success}
One line summary : This paper enhances DFT calculation by proposing novel architecture with refined loss that considers eigenvalues of the Kohn-Sham equations.

# 1 Density-Functional Theory (DFT) and its preliminaries

### 1.1 Kohn–Sham formulation
Given a nuclear configuration

$$
\mathcal{M}
  = \left\{ Z_{1},\dots,Z_{N}\;;\;
            \mathbf R_{1},\dots,\mathbf R_{N} \right\},
$$

DFT recasts the many-body Schrödinger problem as an effective **Kohn–Sham (KS) one-body problem**

$$
\mathbf H\,\mathbf C
  \;=\;
  \mathbf S\,\mathbf C\,\boldsymbol{\epsilon},
\qquad
\rho(\mathbf r)
  = \sum_{i\in\text{occ}}\!
    \bigl|\psi_i(\mathbf r)\bigr|^{2}.
$$

| Symbol | Meaning | Size |
|--------|---------|------|
| $\mathbf H[\rho]$ | KS Hamiltonian: $\mathbf T + \mathbf V_{\text{ext}} + \mathbf V_{\text H}[\rho] + \mathbf V_{\text{xc}}[\rho]$ | $B\times B$ |
| $\mathbf S$ | AO overlap matrix | $B\times B$ |
| $\mathbf C$ | AO → MO coefficients | $B\times N$ |
| $\boldsymbol{\epsilon}$ | $\operatorname{diag}(\epsilon_i)$ (MO energies) | $N\times N$ |

### 1.2 Self-consistent-field (SCF) cost
Each SCF micro-cycle  

1. **Build** $\mathbf H^{(k)}[\rho^{(k-1)}]$ – $\mathcal O(B^{3})$ with density fitting  
2. **Solve** generalised eigensystem – $\mathcal O(B^{3})$  
3. **Mix** density and check convergence  

With $T$ iterations and $B\!\sim\!N$ basis functions, run-time is $\mathcal O\!\bigl(N^{3\text{–}4}\bigr)$.

### 1.3 Why learn the Hamiltonian?
A *physically consistent* $\hat{\mathbf H}$ lets us  

* diagonalise **once** → energies, forces, dipoles, spectra;  
* run at most one SCF step (Δ-SCF);  
* scale as $\mathcal O(B^{3})$ instead of $\mathcal O(T\,B^{3})$.

---

# 2 Method: Wave-function Alignment Loss & WANet

## 2.1 Element-wise losses fail at scale
*Empirical SAD:* on PubChemQH (40–100 atoms) a $10^{-2}$ relative MAE in $\mathbf H$ produces up to
$10^{6}\,\text{kcal}\,\text{mol}^{-1}$ total-energy error.

**Perturbative bound**

$$
\Bigl|
  \lambda_i\bigl(\hat{\mathbf H},\mathbf S\bigr)\!-\!
  \lambda_i\bigl(\mathbf H,\mathbf S\bigr)
\Bigr|
\;\le\;
\frac{\kappa(\mathbf S)}{\lVert\mathbf S\rVert_2}\,
\lVert\Delta\mathbf H\rVert_{1,1},
$$

so a badly conditioned $\mathbf S$ and large $B$ magnify tiny element-wise errors.

## 2.2 Wave-function Alignment Loss (WALoss)

1. **Simultaneous reduction**  
   Diagonalise $(\mathbf H^{\star},\mathbf S)$ ⇒ eigenvectors $\mathbf C^{\star}$ obey
   $(\mathbf C^{\star})^{\!\top}\mathbf S\,\mathbf C^{\star}=\mathbf I$.

2. **Bilinear evaluation**  

   $$
   \tilde{\mathbf H}
     = (\mathbf C^{\star})^{\!\top}\hat{\mathbf H}\,\mathbf C^{\star}.
   $$

3. **Weighted alignment**

   $$
   \mathcal L_{\text{WA}}
     \;=\;
     \rho \sum_{j\in\text{occ}\cup\{\text{LUMO}\}}
       \bigl|\tilde H_{jj}-\epsilon^{\star}_{j}\bigr|^{2}\;+\;
     \xi \sum_{j\notin\text{occ}\cup\{\text{LUMO}\}}
       \bigl|\tilde H_{jj}-\epsilon^{\star}_{j}\bigr|^{2},
   \qquad \rho\gg\xi.
   $$

*(No back-prop through an eigen-solver → numerically stable.)*

## 2.3 WANet architecture

| Stage | Ingredients | Complexity | Purpose |
|-------|-------------|------------|---------|
| Node conv. | eSCN (SO (2) equivariant) | $\mathcal O(L^{3})$ | Cheap irreps |
| Pair block | Sparse MoE - long/short range | constant load | Off-diagonals |
| Diagonal block | MACE many-body layer | $\mathcal O(K\nu)$ | Correlation |
| Head | Clebsch–Gordan + Hermitise | — | Final $\hat{\mathbf H}$ |

All operations are SE (3)-equivariant; output is Hermitian.

---

# 3 Experiments

## 3.1 Datasets

| Dataset | Size | Atoms | Level | Purpose |
|---------|------|-------|-------|---------|
| **QH9** | 130 k | ≤ 9 heavy | B3LYP/def2-SVP | Small-mol sanity |
| **PubChemQH** | 50 k | 40–100 | B3LYP/def2-TZV | Large-scale bench |

(*PubChemQH: 128 × V100 ≈ 1 month.*)

## 3.2 Key metrics
* Hamiltonian MAE  
* Eigen-value MAE: $ϵ_{\text{HOMO}}, ϵ_{\text{LUMO}}, ϵ_{\Delta}$  
* Eigen-vector cosine  
* Total-energy MAE (PySCF)  
* Relative SCF iterations (vs minao guess)

## 3.3 Results (PubChemQH)

| Model | $\text{MAE}(E_{\text{tot}})$ | Rel. SCF | MAE($\mathbf H$) |
|-------|-----------------------------|----------|------------------|
| QHNet | 65 721 | 3.7 × | 0.78 |
| QHNet + WALoss | 75.6 | 0.9 × | 0.52 |
| **WANet + WALoss** | **47.2** | **0.82 ×** | **0.47** |
| Initial guess | 374 | 1.0 × | 0.55 |

Energy ↓ × 1347, SCF steps ↓ 18 %.

## 3.4 Regression baselines
WANet + WALoss beats Equiformer-V2 / UniMol-Plus by **1–2 orders** on $ϵ_{\text{LUMO}}$ and gap.

## 3.5 Scalability test – $\mathrm{C}_x\mathrm H_{2x+2}$
Up to 182 atoms ($x=60$) HOMO/LUMO MAE < 100 kcal mol\(^{-1}\); baselines diverge.

---

# 4 Discussion

1. **Physics supervision ⇒ stability** – WALoss enforces perturbation-theory consistency.  
2. **Pragmatic equivariance** – eSCN cuts SO (3) cost from $O(L^{6})$ to $O(L^{3})$.  
3. **One model, many properties** – $\hat{\mathbf H}$ yields energies, dipoles, spectra, etc.  
4. **Limitations** – dataset cost, forces not yet SCF-free, periodic transfer untested.

---

# 5 Conclusion

**WALoss + WANet** align Hamiltonians with their true eigenspaces, erasing catastrophic scaling for large molecules:

* **total-energy error ↓ 10³×**,  
* **SCF wall-time ↓ ≈ 18 %**,  
* **generalises** to 180-atom alkanes.

This sets a new SOTA for deep-learning-enhanced DFT and edges practical ab-initio accuracy toward millisecond inference.
